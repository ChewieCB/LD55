[gd_scene load_steps=37 format=3 uid="uid://iqw1g1onexq2"]

[ext_resource type="Script" path="res://src/entities/characters/minions/minion_base.gd" id="1_f3oue"]
[ext_resource type="Resource" uid="uid://cjg214btamq4q" path="res://src/entities/characters/minions/SkeletonAttributes.tres" id="2_0u02g"]
[ext_resource type="Resource" uid="uid://nir8erbl55hp" path="res://src/entities/characters/minions/minion_attacks/MinionMaulAttack.tres" id="3_3aqsd"]
[ext_resource type="Shader" path="res://src/utils/shaders/outbound_shadow.gdshader" id="4_6air7"]
[ext_resource type="Texture2D" uid="uid://bsuu6r0m8wm5g" path="res://assets/sprite/characters/minions/skeleton_TEMP_WIP.png" id="4_xl27w"]
[ext_resource type="Script" path="res://addons/godot_state_charts/state_chart.gd" id="5_aa1q7"]
[ext_resource type="Script" path="res://addons/godot_state_charts/parallel_state.gd" id="6_4xj17"]
[ext_resource type="Script" path="res://addons/godot_state_charts/compound_state.gd" id="7_cvo53"]
[ext_resource type="Script" path="res://addons/godot_state_charts/atomic_state.gd" id="8_5qwax"]
[ext_resource type="Script" path="res://addons/godot_state_charts/transition.gd" id="9_jaux2"]
[ext_resource type="Script" path="res://addons/godot_state_charts/state_is_active_guard.gd" id="10_070dc"]
[ext_resource type="Script" path="res://addons/godot_state_charts/not_guard.gd" id="11_hja2u"]
[ext_resource type="Texture2D" uid="uid://bixxqrw5c3q7e" path="res://assets/particles/SmallStar_64x64.png" id="12_6vtvd"]
[ext_resource type="Script" path="res://addons/godot_state_charts/all_of_guard.gd" id="12_7x0ji"]
[ext_resource type="Texture2D" uid="uid://43injemtwjgx" path="res://assets/particles/PoisonClaw_96x96.png" id="13_eaou2"]
[ext_resource type="Animation" uid="uid://dbxt5qt54x8o" path="res://assets/anims/hurt.res" id="13_xvg8j"]
[ext_resource type="Texture2D" uid="uid://brmlt6rgwrn1w" path="res://assets/particles/Explosion_2_64x64.png" id="14_eqdax"]
[ext_resource type="PackedScene" uid="uid://crdcf3pu3urwg" path="res://src/ui/status/status_ui.tscn" id="14_q5bwy"]
[ext_resource type="PackedScene" path="res://src/entities/characters/minions/MinionHealthBar.tscn" id="17_ivnfs"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_negqm"]
shader = ExtResource("4_6air7")
shader_parameter/deform = Vector2(1, 1)
shader_parameter/offset = Vector2(12.145, 24.075)
shader_parameter/modulate = Color(0, 0, 0, 0.5)
shader_parameter/x_buffer = 2.0
shader_parameter/y_buffer = 2.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ci4kf"]
size = Vector2(21, 44)

[sub_resource type="CircleShape2D" id="CircleShape2D_v6t7d"]
radius = 40.0

[sub_resource type="Resource" id="Resource_srrmh"]
script = ExtResource("10_070dc")
state = NodePath("../../../Attacking/BasicAttack")

[sub_resource type="Resource" id="Resource_wljmr"]
script = ExtResource("11_hja2u")
guard = SubResource("Resource_srrmh")

[sub_resource type="Resource" id="Resource_p6r68"]
script = ExtResource("10_070dc")
state = NodePath("../../../Damage/Dead")

[sub_resource type="Resource" id="Resource_srkw7"]
script = ExtResource("11_hja2u")
guard = SubResource("Resource_p6r68")

[sub_resource type="Resource" id="Resource_rb1lx"]
script = ExtResource("12_7x0ji")
guards = Array[Resource("res://addons/godot_state_charts/guard.gd")]([SubResource("Resource_wljmr"), SubResource("Resource_srkw7")])

[sub_resource type="Animation" id="Animation_a6hs8"]
resource_name = "attack"
length = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AttackParticles:emitting")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_qcj21"]
resource_name = "death"
length = 1.2
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.7, 1.2),
"transitions": PackedFloat32Array(0.34151, 0.34151, 1),
"update": 0,
"values": [Color(1, 1, 1, 1), Color(1, 1, 1, 1), Color(1, 1, 1, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("DeathParticles:emitting")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_lj4jm"]
_data = {
"attack": SubResource("Animation_a6hs8"),
"death": SubResource("Animation_qcj21"),
"hurt": ExtResource("13_xvg8j")
}

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_lb03b"]
particles_animation = true
particles_anim_h_frames = 31
particles_anim_v_frames = 1
particles_anim_loop = true

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_0t0au"]
particle_flag_disable_z = true
gravity = Vector3(0, 0, 0)
scale_min = 0.7
scale_max = 0.7
anim_speed_min = 1.0
anim_speed_max = 1.0

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_pbyd6"]
particles_animation = true
particles_anim_h_frames = 60
particles_anim_v_frames = 1
particles_anim_loop = true

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_ppx6g"]
particle_flag_disable_z = true
gravity = Vector3(0, 0, 0)
anim_speed_min = 1.0
anim_speed_max = 1.0

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_mbyvb"]
particles_animation = true
particles_anim_h_frames = 44
particles_anim_v_frames = 1
particles_anim_loop = false

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_paynb"]
lifetime_randomness = 0.11
particle_flag_disable_z = true
emission_shape = 3
emission_box_extents = Vector3(16, 16, 1)
gravity = Vector3(0, 0, 0)
scale_min = 0.7
scale_max = 1.3
anim_speed_min = 1.0
anim_speed_max = 1.0

[node name="Skeleton" type="CharacterBody2D"]
y_sort_enabled = true
collision_layer = 2
collision_mask = 0
script = ExtResource("1_f3oue")
resource_attributes = ExtResource("2_0u02g")
attacks = Array[Resource("res://src/entities/characters/attack_resource.gd")]([ExtResource("3_3aqsd")])

[node name="ColorRect" type="ColorRect" parent="."]
visible = false
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -17.0
offset_top = -17.0
offset_right = 17.0
offset_bottom = 17.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0.431373, 0.427451, 0.415686, 1)

[node name="Sprite2D" type="Sprite2D" parent="."]
material = SubResource("ShaderMaterial_negqm")
scale = Vector2(0.08, 0.08)
texture = ExtResource("4_xl27w")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0.5, 1)
shape = SubResource("RectangleShape2D_ci4kf")

[node name="AttackRange" type="Area2D" parent="."]
collision_layer = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="AttackRange"]
shape = SubResource("CircleShape2D_v6t7d")

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
target_desired_distance = 64.0
avoidance_enabled = true
radius = 32.0
avoidance_layers = 2
avoidance_mask = 2

[node name="StateChart" type="Node" parent="."]
script = ExtResource("5_aa1q7")

[node name="Root" type="Node" parent="StateChart"]
script = ExtResource("6_4xj17")

[node name="Movement" type="Node" parent="StateChart/Root"]
script = ExtResource("7_cvo53")
initial_state = NodePath("Walking")

[node name="Idle" type="Node" parent="StateChart/Root/Movement"]
script = ExtResource("8_5qwax")

[node name="toWalking" type="Node" parent="StateChart/Root/Movement/Idle"]
script = ExtResource("9_jaux2")
to = NodePath("../../Walking")
event = &"start_walking"
guard = SubResource("Resource_rb1lx")

[node name="Walking" type="Node" parent="StateChart/Root/Movement"]
script = ExtResource("8_5qwax")

[node name="toIdle" type="Node" parent="StateChart/Root/Movement/Walking"]
script = ExtResource("9_jaux2")
to = NodePath("../../Idle")
event = &"stop_walking"

[node name="Attacking" type="Node" parent="StateChart/Root"]
script = ExtResource("7_cvo53")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateChart/Root/Attacking"]
script = ExtResource("8_5qwax")

[node name="toBasicAttack" type="Node" parent="StateChart/Root/Attacking/Idle"]
script = ExtResource("9_jaux2")
to = NodePath("../../BasicAttack")
event = &"attack"

[node name="BasicAttack" type="Node" parent="StateChart/Root/Attacking"]
script = ExtResource("8_5qwax")

[node name="toIdle" type="Node" parent="StateChart/Root/Attacking/BasicAttack"]
script = ExtResource("9_jaux2")
to = NodePath("../../Idle")
event = &"finish_attack"

[node name="Damage" type="Node" parent="StateChart/Root"]
script = ExtResource("7_cvo53")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateChart/Root/Damage"]
script = ExtResource("8_5qwax")

[node name="toHit" type="Node" parent="StateChart/Root/Damage/Idle"]
script = ExtResource("9_jaux2")
to = NodePath("../../Hit")
event = &"take_damage"

[node name="toDead" type="Node" parent="StateChart/Root/Damage/Idle"]
script = ExtResource("9_jaux2")
to = NodePath("../../Dead")
event = &"death"

[node name="Hit" type="Node" parent="StateChart/Root/Damage"]
script = ExtResource("8_5qwax")

[node name="toIdle" type="Node" parent="StateChart/Root/Damage/Hit"]
script = ExtResource("9_jaux2")
to = NodePath("../../../Movement/Idle")
event = &"end_damage"

[node name="toDead" type="Node" parent="StateChart/Root/Damage/Hit"]
script = ExtResource("9_jaux2")
to = NodePath("../../Dead")
event = &"death"

[node name="Dead" type="Node" parent="StateChart/Root/Damage"]
script = ExtResource("8_5qwax")

[node name="Status" type="Node" parent="StateChart/Root"]
script = ExtResource("7_cvo53")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateChart/Root/Status"]
script = ExtResource("8_5qwax")

[node name="toStaggered" type="Node" parent="StateChart/Root/Status/Idle"]
script = ExtResource("9_jaux2")
to = NodePath("../../Staggered")
event = &"stagger"

[node name="toStunned" type="Node" parent="StateChart/Root/Status/Idle"]
script = ExtResource("9_jaux2")
to = NodePath("../../Stunned")
event = &"stun"

[node name="Staggered" type="Node" parent="StateChart/Root/Status"]
script = ExtResource("8_5qwax")

[node name="toIdle" type="Node" parent="StateChart/Root/Status/Staggered"]
script = ExtResource("9_jaux2")
to = NodePath("../../Idle")
event = &"recover_stagger"

[node name="toStunned" type="Node" parent="StateChart/Root/Status/Staggered"]
script = ExtResource("9_jaux2")
to = NodePath("../../Stunned")
event = &"stun"

[node name="Stunned" type="Node" parent="StateChart/Root/Status"]
script = ExtResource("8_5qwax")

[node name="toIdle" type="Node" parent="StateChart/Root/Status/Stunned"]
script = ExtResource("9_jaux2")
to = NodePath("../../Idle")
event = &"recover_stun"

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_lj4jm")
}

[node name="AttackParticles" type="GPUParticles2D" parent="."]
material = SubResource("CanvasItemMaterial_lb03b")
emitting = false
amount = 1
process_material = SubResource("ParticleProcessMaterial_0t0au")
texture = ExtResource("13_eaou2")
lifetime = 0.5
one_shot = true
speed_scale = 2.0
explosiveness = 0.25

[node name="BlockParticles" type="GPUParticles2D" parent="."]
material = SubResource("CanvasItemMaterial_pbyd6")
emitting = false
amount = 1
process_material = SubResource("ParticleProcessMaterial_ppx6g")
texture = ExtResource("12_6vtvd")
lifetime = 0.2
one_shot = true
explosiveness = 0.19

[node name="DeathParticles" type="GPUParticles2D" parent="."]
material = SubResource("CanvasItemMaterial_mbyvb")
emitting = false
amount = 3
process_material = SubResource("ParticleProcessMaterial_paynb")
texture = ExtResource("14_eqdax")
one_shot = true
explosiveness = 0.62
randomness = 0.1

[node name="AttackBuildupTimer" type="Timer" parent="."]
one_shot = true

[node name="AttackCooldownTimer" type="Timer" parent="."]
one_shot = true

[node name="StaggerStunTimer" type="Timer" parent="."]
one_shot = true

[node name="HealthBar" parent="." instance=ExtResource("17_ivnfs")]
offset_left = -24.0
offset_top = -40.0
offset_right = 32.0
offset_bottom = -26.0

[node name="StatusUI" parent="." instance=ExtResource("14_q5bwy")]

[connection signal="velocity_computed" from="NavigationAgent2D" to="." method="_on_navigation_agent_2d_velocity_computed"]
[connection signal="state_entered" from="StateChart/Root/Movement/Idle" to="." method="_on_idle_state_entered"]
[connection signal="state_physics_processing" from="StateChart/Root/Movement/Idle" to="." method="_on_idle_state_physics_processing"]
[connection signal="state_physics_processing" from="StateChart/Root/Movement/Walking" to="." method="_on_walking_state_physics_processing"]
[connection signal="state_physics_processing" from="StateChart/Root/Attacking/Idle" to="." method="_on_attacking_idle_state_physics_processing"]
[connection signal="state_entered" from="StateChart/Root/Attacking/BasicAttack" to="." method="_on_attacking_basic_attack_state_entered"]
[connection signal="state_entered" from="StateChart/Root/Damage/Dead" to="." method="_on_dead_state_entered"]
[connection signal="state_entered" from="StateChart/Root/Status/Staggered" to="." method="_on_status_staggered_state_entered"]
[connection signal="state_exited" from="StateChart/Root/Status/Staggered" to="." method="_on_status_staggered_state_exited"]
[connection signal="state_entered" from="StateChart/Root/Status/Stunned" to="." method="_on_status_stunned_state_entered"]
[connection signal="state_exited" from="StateChart/Root/Status/Stunned" to="." method="_on_status_stunned_state_exited"]
[connection signal="timeout" from="StaggerStunTimer" to="." method="_on_stagger_stun_timer_timeout"]
